<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premier League Analytics Dashboard | Understat Data Visualization</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            color: #38003c;
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            color: #666;
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-card i {
            font-size: 3rem;
            color: #38003c;
            margin-bottom: 1rem;
        }

        .stat-value {
            font-size: 3rem;
            font-weight: 700;
            color: #38003c;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 1.1rem;
        }

        .charts-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .chart-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin-bottom: 3rem;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .chart-header {
            background: linear-gradient(135deg, #38003c, #651fff);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .chart-header h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .chart-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .chart-content {
            padding: 2rem;
        }

        .chart-canvas {
            position: relative;
            height: 400px;
            margin: 1rem 0;
        }

        .tall-chart {
            height: 500px;
        }

        .scatter-chart {
            height: 600px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #38003c, #651fff);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(56, 0, 60, 0.3);
        }

        .control-btn.active {
            background: linear-gradient(135deg, #651fff, #38003c);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            font-size: 1.2rem;
            color: #666;
        }

        .loading i {
            animation: spin 2s linear infinite;
            margin-right: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }

        .footer a {
            color: #651fff;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                padding: 1rem;
                gap: 1rem;
            }

            .chart-content {
                padding: 1rem;
            }
        }

        /* Custom tooltip styles */
        .custom-tooltip {
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-size: 0.9rem;
            pointer-events: none;
            position: absolute;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1><i class="fas fa-trophy"></i> Premier League Analytics</h1>
        <p>Comprehensive data visualization and analysis of Premier League player statistics from 2014-2026 using Understat.com data</p>
    </header>

    <section class="stats-grid" id="overview-stats">
        <div class="stat-card">
            <i class="fas fa-database"></i>
            <div class="stat-value" id="total-records">-</div>
            <div class="stat-label">Total Records</div>
        </div>
        <div class="stat-card">
            <i class="fas fa-users"></i>
            <div class="stat-value" id="unique-players">-</div>
            <div class="stat-label">Unique Players</div>
        </div>
        <div class="stat-card">
            <i class="fas fa-shield-alt"></i>
            <div class="stat-value" id="teams-count">-</div>
            <div class="stat-label">Teams</div>
        </div>
        <div class="stat-card">
            <i class="fas fa-calendar"></i>
            <div class="stat-value" id="seasons-count">-</div>
            <div class="stat-label">Seasons</div>
        </div>
    </section>

    <main class="charts-container">
        <!-- Top Scorers by Season -->
        <section class="chart-section">
            <div class="chart-header">
                <h2><i class="fas fa-futbol"></i> Top Scorers by Season</h2>
                <p>Premier League leading goalscorers across all seasons</p>
            </div>
            <div class="chart-content">
                <div class="chart-canvas">
                    <canvas id="topScorersChart"></canvas>
                </div>
            </div>
        </section>

        <!-- xG vs Goals Analysis -->
        <section class="chart-section">
            <div class="chart-header">
                <h2><i class="fas fa-chart-scatter"></i> Expected Goals vs Actual Goals</h2>
                <p>Current season analysis: How players perform against their expected goals</p>
            </div>
            <div class="chart-content">
                <div class="chart-canvas scatter-chart">
                    <canvas id="xgVsGoalsChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Position Analysis -->
        <section class="chart-section">
            <div class="chart-header">
                <h2><i class="fas fa-chess"></i> Performance by Position</h2>
                <p>Average statistics breakdown by player position</p>
            </div>
            <div class="chart-content">
                <div class="controls">
                    <button class="control-btn active" onclick="updatePositionChart('goals')">Goals</button>
                    <button class="control-btn" onclick="updatePositionChart('assists')">Assists</button>
                    <button class="control-btn" onclick="updatePositionChart('shots')">Shots</button>
                    <button class="control-btn" onclick="updatePositionChart('key_passes')">Key Passes</button>
                </div>
                <div class="chart-canvas">
                    <canvas id="positionChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Team Performance Over Time -->
        <section class="chart-section">
            <div class="chart-header">
                <h2><i class="fas fa-line-chart"></i> Team Performance Timeline</h2>
                <p>Goals scored by teams across seasons (Big 6 focus)</p>
            </div>
            <div class="chart-content">
                <div class="chart-canvas tall-chart">
                    <canvas id="teamTimelineChart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>
            Data sourced from <a href="https://understat.com" target="_blank">Understat.com</a> | 
            Built with <i class="fas fa-heart" style="color: red;"></i> using Chart.js & D3.js |
            <a href="https://github.com/vibedatascience/understat_players_aggregated" target="_blank">
                <i class="fab fa-github"></i> View on GitHub
            </a>
        </p>
        <p style="margin-top: 1rem; opacity: 0.7;">Last updated: <span id="last-updated">-</span></p>
    </footer>

    <script>
        // Global variables
        let data = null;
        let charts = {};

        // Color schemes
        const colors = {
            primary: '#38003c',
            secondary: '#651fff',
            accent: '#e91e63',
            success: '#00c851',
            warning: '#ff8800',
            info: '#33b5e5'
        };

        const teamColors = {
            'Manchester City': '#6CABDD',
            'Manchester United': '#DA020E',
            'Liverpool': '#C8102E',
            'Arsenal': '#EF0107',
            'Chelsea': '#034694',
            'Tottenham': '#132257',
            'Newcastle United': '#241F20',
            'West Ham United': '#7A263A',
            'Leicester City': '#003090',
            'Everton': '#003399'
        };

        // Load data and initialize dashboard
        async function loadData() {
            try {
                const response = await fetch('epl_analysis_data.json');
                data = await response.json();
                updateOverviewStats();
                createCharts();
                document.getElementById('last-updated').textContent = data.overview.last_updated;
            } catch (error) {
                console.error('Error loading data:', error);
                document.body.innerHTML = '<div class="loading"><i class="fas fa-exclamation-circle"></i>Error loading data. Please try again later.</div>';
            }
        }

        function updateOverviewStats() {
            document.getElementById('total-records').textContent = data.overview.total_records.toLocaleString();
            document.getElementById('unique-players').textContent = data.overview.unique_players.toLocaleString();
            document.getElementById('teams-count').textContent = data.overview.teams_count;
            document.getElementById('seasons-count').textContent = data.overview.seasons_covered.length;
        }

        function createCharts() {
            createTopScorersChart();
            createXGvsGoalsChart();
            createPositionChart();
            createTeamTimelineChart();
        }

        function createTopScorersChart() {
            const ctx = document.getElementById('topScorersChart').getContext('2d');
            
            const chartData = data.top_scorers_by_season.slice(-8); // Last 8 seasons
            
            charts.topScorers = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(d => d.season),
                    datasets: [{
                        label: 'Goals',
                        data: chartData.map(d => d.goals),
                        backgroundColor: colors.primary,
                        borderColor: colors.secondary,
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }, {
                        label: 'Expected Goals (xG)',
                        data: chartData.map(d => d.xG),
                        backgroundColor: colors.secondary + '80',
                        borderColor: colors.secondary,
                        borderWidth: 2,
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const item = chartData[context.dataIndex];
                                    return [`Player: ${item.player}`, `Team: ${item.team}`];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Goals / xG'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Season'
                            }
                        }
                    }
                }
            });
        }

        function createXGvsGoalsChart() {
            const ctx = document.getElementById('xgVsGoalsChart').getContext('2d');
            
            const chartData = data.xg_vs_goals_current.filter(d => d.games >= 5);
            
            charts.xgVsGoals = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Players',
                        data: chartData.map(d => ({ x: d.xG, y: d.goals })),
                        backgroundColor: chartData.map(d => teamColors[d.team] || colors.accent),
                        borderColor: colors.primary,
                        borderWidth: 1,
                        pointRadius: 8,
                        pointHoverRadius: 12
                    }, {
                        label: 'Perfect Conversion',
                        data: [{x: 0, y: 0}, {x: Math.max(...chartData.map(d => d.xG)), y: Math.max(...chartData.map(d => d.xG))}],
                        type: 'line',
                        borderColor: colors.success,
                        borderDash: [5, 5],
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        const player = chartData[context.dataIndex];
                                        return [
                                            `${player.name} (${player.team})`,
                                            `Goals: ${player.goals}`,
                                            `xG: ${player.xG}`,
                                            `Games: ${player.games}`
                                        ];
                                    }
                                    return 'Perfect Conversion Line';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Expected Goals (xG)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Actual Goals'
                            }
                        }
                    }
                }
            });
        }

        function createPositionChart() {
            const ctx = document.getElementById('positionChart').getContext('2d');
            
            const positionLabels = {
                'GK': 'Goalkeeper',
                'D': 'Defender',
                'M': 'Midfielder',
                'F': 'Forward',
                'S': 'Substitute'
            };
            
            charts.position = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: data.position_analysis.map(d => positionLabels[d.position] || d.position),
                    datasets: [{
                        label: 'Average Goals',
                        data: data.position_analysis.map(d => d.avg_goals),
                        backgroundColor: colors.primary + '40',
                        borderColor: colors.primary,
                        borderWidth: 3,
                        pointBackgroundColor: colors.primary,
                        pointBorderColor: '#fff',
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Average Goals per Season'
                            }
                        }
                    }
                }
            });
        }

        function updatePositionChart(metric) {
            // Update button states
            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const metricMap = {
                'goals': 'avg_goals',
                'assists': 'avg_assists',
                'shots': 'avg_shots',
                'key_passes': 'avg_key_passes'
            };

            const actualMetric = metricMap[metric];
            const label = metric.charAt(0).toUpperCase() + metric.slice(1).replace('_', ' ');

            charts.position.data.datasets[0] = {
                label: `Average ${label}`,
                data: data.position_analysis.map(d => d[actualMetric]),
                backgroundColor: colors.secondary + '40',
                borderColor: colors.secondary,
                borderWidth: 3,
                pointBackgroundColor: colors.secondary,
                pointBorderColor: '#fff',
                pointRadius: 6
            };

            charts.position.options.scales.r.title.text = `Average ${label} per Season`;
            charts.position.update();
        }

        function createTeamTimelineChart() {
            const ctx = document.getElementById('teamTimelineChart').getContext('2d');
            
            const bigSixTeams = ['Manchester City', 'Manchester United', 'Liverpool', 'Arsenal', 'Chelsea', 'Tottenham'];
            const seasons = data.overview.seasons_covered.slice(-6); // Last 6 seasons
            
            const datasets = bigSixTeams.map(team => {
                const teamData = data.team_performance.filter(d => 
                    d.team === team && seasons.includes(d.season)
                );
                
                return {
                    label: team,
                    data: seasons.map(season => {
                        const seasonData = teamData.find(d => d.season === season);
                        return seasonData ? seasonData.total_goals : 0;
                    }),
                    borderColor: teamColors[team] || colors.accent,
                    backgroundColor: (teamColors[team] || colors.accent) + '20',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 6,
                    pointHoverRadius: 10
                };
            });

            charts.teamTimeline = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: seasons,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Total Goals Scored'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Season'
                            }
                        }
                    }
                }
            });
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>